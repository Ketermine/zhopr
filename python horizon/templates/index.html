<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Job Dashboard</title>
    <!-- Bootstrap CSS for modern styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* A little custom style to match the original feel */
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,.05); border: none; }
    </style>
</head>
<body>
    <div class="container-fluid my-4">
        <h1 class="mb-4">IT System Manager Analysis - Darmstadt</h1>

        <!-- Filter Form Card -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Filters</h5>
                <form method="GET" action="/">
                    <div class="row align-items-end g-3">
                        <div class="col-md-4">
                            <label for="search" class="form-label">Search Term</label>
                            <input type="text" class="form-control" id="search" name="search" value="{{ search_query or '' }}" placeholder="e.g., Python, Senior">
                        </div>
                        <div class="col-md-3">
                            <label for="min_salary" class="form-label">Min Salary (€)</label>
                            <input type="number" class="form-control" id="min_salary" name="min_salary" value="{{ min_salary or '' }}" placeholder="e.g., 60000">
                        </div>
                        <div class="col-md-3">
                            <label for="job_type" class="form-label">Job Type</label>
                            <select class="form-select" id="job_type" name="job_type">
                                <option value="" {% if not job_type %}selected{% endif %}>Any</option>
                                <option value="Full-time" {% if job_type == 'Full-time' %}selected{% endif %}>Full-time</option>
                                <option value="Remote" {% if job_type == 'Remote' %}selected{% endif %}>Remote</option>
                                <option value="Hybrid" {% if job_type == 'Hybrid' %}selected{% endif %}>Hybrid</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="row">
            <!-- Left Column: Job Listings & KPIs -->
            <div class="col-lg-8">
                <!-- KPI Cards -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">Total Jobs Found</h6>
                                <p class="card-text fs-2 fw-bold">{{ job_count }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Job Listings -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Job Listings</h5>
                        {% for job in jobs %}
                            <div class="border-bottom {% if loop.last %}border-bottom-0{% endif %} py-3">
                                <h6>{{ job.title }}</h6>
                                <div class="text-muted small">
                                    <span><strong>Company:</strong> {{ job.company }}</span> |
                                    <span><strong>Location:</strong> {{ job.location }}</span> |
                                    <span><strong>Salary:</strong> €{{ "{:,.0f}".format(job.salary_min) }} - €{{ "{:,.0f}".format(job.salary_max) }}</span>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-center text-muted mt-3">No jobs match your criteria.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Column: Charts and Activity -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Insights</h5>
                        <div>{{ salary_dist_chart | safe }}</div>
                        <div>{{ exp_dist_chart | safe }}</div>
                        <div>{{ salary_trend_chart | safe }}</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Recent Activity</h5>
                        <ul class="list-group list-group-flush">
                            {% for activity in activities %}
                                <li class="list-group-item"><strong>{{ activity.user }}:</strong> {{ activity.action }} <span class="text-muted small">({{ activity.timestamp }})</span></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>